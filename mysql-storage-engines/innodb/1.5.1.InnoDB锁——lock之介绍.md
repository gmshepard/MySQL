# Lock - 事务锁

## 与 latch 的区别

lock对象是事务，用来锁定的是数据库中的对象，如表、行、页。并且一般lock的对象仅在事务commit或rollback后进行释放（不同事务隔离级别释放的时间可能不同）。此外，lock，正如在大多数数据库中一样，是有死锁机制的。

## InnoDB中B+树的层次结构——对这些结构加事务锁

首先了解一下数据是怎么存放的，他的一个层次结构，方便理解



![1.5.8.InnoDB中B+树的层次结构](../..//mysql-image/1.5.8.InnoDB%E4%B8%ADB%2B%E6%A0%91%E7%9A%84%E5%B1%82%E6%AC%A1%E7%BB%93%E6%9E%84.jpg)

## 加锁原则

二阶段加锁原则

- 加锁阶段
- 解锁阶段

所有的事务必须分两个阶段对数据项加锁和解锁。即事务分两个阶段，第一个阶段是获得封锁。事务可以获得任何数据项上的任何类型的锁，但是不能释放；第二阶段是释放封锁，事务可以释放任何数据项上的任何类型的锁，但不能申请

加锁解锁互不相交，各司其职

![1.5.6.二阶段加锁原则.jpg](../../mysql-image/1.5.6.%E4%BA%8C%E9%98%B6%E6%AE%B5%E5%8A%A0%E9%94%81%E5%8E%9F%E5%88%99.jpg)

