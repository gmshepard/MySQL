# 平均值组大小

## 了解平均值组大小

总数据量 / 值组 = 平均值组大小

- 值组是**一组具有相同键前缀值的行，及所有相等的键为一个值组**。
- 总数据量为全表数据量

## MySQL什么时候会使用平均值组大小

1. 估算每次ref访问 必须读取多少行
   (EXPLAIN中，type中的ref,访问索引时，同一个参数可能有多个相同的值)
2. 估计部分联接将产生多少行；也就是说，这种形式的操作将产生的行数：
   select * from table_1 JOIN table_2 ON table_2.id = table_1.id;

## 平均值组大小对于索引选取的影响

随着索引的平均值组大小的增加，该索引在这两个用途中的作用不大，因为每次查找的平均行数增加。为了使索引更好地用于优化目的，最好将每个索引值作为目标表中的行数。
当某个索引会扫描大量的行时，该索引的用处不大，MySQL不太可能使用它。

例如，user1中有20W条数据。

		sex建立索引，值组为 2(因为只有男女两种值)，组值平均大小为 10w(假设男女数量一致。)
	
		province建立索引，值组为 34(全国有34个省、省级市直辖区等), 组值平均大小为: 20w/34 约为 5882 (假设每个省数据量一致)
	
		对比可知，sex的平均值组大小 > province的平均值组大小；
	
		sex的选择性低于province的选择性，所以当MySQL要走sex这个索引时，他需要扫描更多的行，所需要的成本越高。成本来源于扫描行数、磁盘IO、CPU调度、所占内存等



平均值组的大小与表基数有关，表基数是值组的数目。该 SHOW INDEX语句显示基于的基数值N/S，其中 N是表中的行数，并且S是平均值组的大小。该比率在表中产生大约数量的值组。

	理解：拿上边性别举例：N为全部数据量20W，值组为2，S为 20W/2 = 10w

以一个具体表为例：
`mysql> show index from user1;`
![索引——show index from table.png](../mysql-image/索引——show%20index%20from%20table.png)

> 大概解读：
>
> - 主键user_id：肯定是唯一的，代表全表数据量	  基数：208534  值组：208534  平均值组大小：208534
> - 年龄大约是 1~100应该是100个不同的数字   基数：101     值组：101     平均值组大小：208688/101
> - 省份应该是 34，统计略有偏差			  基数：22      值组：22      平均值组大小：208688/22
> - 性别应该是 2， 统计错误 				  基数：1       值组：1       平均值组大小：208688

详细参数及含义

- `Table`
  表的名称。

- Non_unique
  如果索引不能包含重复项，则为0；如果可以，则为1。

- Key_name
  索引名称。如果索引是主键，则名称始终为PRIMARY。

- Seq_in_index

  索引中的列序号，从1开始。（省市区为123 性别省市区为1234）

- Column_name
  列的名称。

- Collation
  列在索引中的排序方式。它可以具有 A（升序）或NULL （未排序）值。

- Cardinality
  索引中唯一值数量的估计。要更新此数字，请运行ANALYZE TABLE或（对于MyISAM表） 运行myisamchk -a。

  Cardinality基于存储为整数的统计信息进行计数，因此即使对于小型表，该值也不一定准确。基数越高，MySQL在进行联接时使用索引的机会越大。

- Sub_part
  如果列只是被部分地编入索引，则为被编入索引的字符的数目。如果整列被编入索引，则为NULL。

  注意
  前缀限制以字节为单位。然而，前缀长度为索引规范CREATE TABLE，ALTER TABLE和CREATE INDEX语句解释为非二进制串类型的字符数（CHAR， VARCHAR， TEXT对于二进制串类型），并且字节数（BINARY， VARBINARY， BLOB）。为使用多字节字符集的非二进制字符串列指定前缀长度时，请考虑到这一点。

  有关索引前缀的更多信息，请参见 第8.3.4节“列索引”和 第13.1.14节“ CREATE INDEX语句”。

- Packed
  指示关键字如何被压缩。如果没有被压缩，则为NULL。

- Null
  如果列含有NULL，则含有YES。如果没有，则该列含有NO。

- Index_type
  用过的索引方法（BTREE, FULLTEXT, HASH, RTREE）。

- Comment
  关于索引的信息未在其自己的列中描述，例如disabled是否禁用了索引。

- Index_comment
  COMMENT创建索引时，为索引 提供的任何注释均带有 属性。